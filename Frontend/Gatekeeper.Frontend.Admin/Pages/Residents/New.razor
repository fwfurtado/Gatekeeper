@page "/residents/new"
@using Gatekeeper.Frontend.Admin.Dtos

@inject HttpClient Http
@inject ISnackbar Snackbar
@inject NavigationManager NavigationManager
@inject ILogger<New> Logger


<PageTitle>Resident</PageTitle>


<MudText Typo="Typo.h2">New Resident</MudText>
<MudPaper Class="pa-4">
    <MudForm Model="@Form">
        <MudTextField T="string" @bind-value="Form.Name" Label="Name" Required="true" RequiredError="Name is required!"/>
        <MudTextField T="string" @bind-value="Form.Document" Label="Document" Required="true" RequiredError="Document is required!"/>
        <MudButton Color="Color.Primary" OnClick="async () => await SaveResident()">Save</MudButton>
    </MudForm>
</MudPaper>


@code {
    public ResidentForm Form = new();

    private async Task SaveResident()
    {
        var response = await Http.PostAsJsonAsync("/residents", new ResidentRequest() { Name = Form.Name, Document = Form.Document });

        if (response.IsSuccessStatusCode)
        {
            Snackbar.Add("Resident saved", Severity.Success);
            NavigationManager.NavigateTo("/residents");
        }
        else
        {
            var log = $"reponse received from REST {response}";
            Logger.LogInformation(log);
            Snackbar.Add("Error saving resident", Severity.Error);
        }
    }
}